FROM node:18-alpine

# Installer curl pour les healthchecks
RUN apk add --no-cache curl

WORKDIR /app

# Installer les dépendances
COPY api/package*.json ./api/
RUN cd api && npm ci --only=production

# Copier le code source
COPY api ./api

# Copier et rendre exécutable le script d'entrypoint
COPY api/entrypoint.sh /app/api/entrypoint.sh
RUN chmod +x /app/api/entrypoint.sh

WORKDIR /app/api

EXPOSE 3001

# Utiliser l'entrypoint au lieu de CMD direct
ENTRYPOINT ["/app/api/entrypoint.sh"]

